version: "3"

tasks:
  install:
    desc: Install web dependencies
    cmds:
      - '[ -f package-lock.json ] && npm ci || npm install'
  dev:
    desc: Run web dev server
    cmds:
      - npm run dev
  prisma:generate:
    desc: Generate Prisma client
    env:
      XDG_CACHE_HOME: ./.cache
      PRISMA_ENGINES_CACHE_DIR: ./.cache/prisma
      PRISMA_QUERY_ENGINE_LIBRARY: ./node_modules/@prisma/engines/libquery_engine-darwin-arm64.dylib.node
      PRISMA_SCHEMA_ENGINE_BINARY: ./node_modules/@prisma/engines/schema-engine-darwin-arm64
      PRISMA_ENGINES_CHECKSUM_IGNORE_MISSING: "1"
    cmds:
      - mkdir -p .cache/prisma
      - npm run prisma:generate
  router:generate:
    desc: Generate React Router types
    cmds:
      - npm run router:typegen
  ci:check:
    desc: Lint/typecheck
    cmds:
      - npm run ci:check
  ci:build:
    desc: Build web app
    cmds:
      - npm run ci:build
  ci:test:
    desc: Run frontend tests
    cmds:
      - npm run ci:test
